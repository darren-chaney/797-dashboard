<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>797 Distillery – Print Barrel Label</title>

<!-- APP VERSION -->
<meta name="app-version" content="Print Label v1.0.6">

<!-- Header CSS -->
<link rel="stylesheet" href="header.css?v=1.0.0">

<!-- QR Code -->
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

<style>
/* =========================
   PAGE GLOBAL
   ========================= */
:root{
  --bg:#0f172a;
  --panel:#111c33;
  --border:#334155;
  --text:#e5e7eb;
  --muted:#9ca3af;
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
}

.container{
  max-width:1100px;
  margin:0 auto;
  padding:16px;
}

/* VERSION BADGE */
.version-badge{
  font-size:12px;
  font-weight:800;
  color:var(--muted);
  margin-bottom:10px;
}

/* CONTROLS */
.controls{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:12px;
  padding:14px;
  display:grid;
  grid-template-columns:1fr auto auto auto;
  gap:10px;
  margin-bottom:14px;
}

select,button{
  padding:10px 14px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#0b1222;
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  font-size:15px;
  font-weight:700;
}

select option{
  font-size:15px;
  font-weight:700;
}

button{cursor:pointer}
button:disabled{opacity:.5;cursor:not-allowed}

/* =========================
   LABEL (4x6)
   ========================= */
.label{
  width:6in;
  height:4in;
  background:#fff;
  color:#000;
  padding:18px;
  box-sizing:border-box;
  font-family:Arial,Helvetica,sans-serif;
  display:none;
}

/* TOP HEADER */
.lbl-header{
  display:flex;
  align-items:flex-start;
  gap:22px;              /* slightly more breathing room */
}

/* PRODUCT LETTER — MAXIMUM PRINT WEIGHT */
.lbl-r{
  font-size:120px;
  font-weight:900;
  line-height:0.95;
  min-width:155px;

  letter-spacing:1px;
  transform:scaleX(1.22);

  /* REAL stroke weight */
  -webkit-text-stroke: 2px #000;
  text-stroke: 2px #000;

  /* fill stays solid */
  color:#000;

  /* fallback mass for non-stroke engines */
  text-shadow:
    1px 0   0 #000,
   -1px 0   0 #000,
    0   1px 0 #000,
    0  -1px 0 #000;
}

/* RIGHT TEXT BLOCK */
.lbl-header-text{
  font-size:18.5px;      /* slightly larger */
  font-weight:900;      /* heavier overall */
  line-height:1.25;
}

/* DISTILLERY NAME */
.lbl-title{
  font-size:24px;        /* stronger hierarchy */
  font-weight:900;
}

/* DSP LINE */
.lbl-dsp{
  font-size:17px;
  font-weight:900;
  margin-top:3px;
}

.lbl-rule{
  border-top:3px solid #000;
  margin:8px 0;
}

/* DATA */
.lbl-data{
  font-size:16px;
  line-height:1.55;
}

.lbl-data span{
  display:inline-block;
  width:200px;
  font-weight:900;
}

/* LOGO */
.lbl-crest{text-align:center}

.crest-img{
  height:240px;
  max-width:100%;
  display:block;
  margin:4px auto;
}

/* BARREL */
.lbl-barrel{
  text-align:center;
  font-size:30px;
  font-weight:900;
}

/* QR */
.lbl-qr{
  display:flex;
  justify-content:center;
}

.lbl-qr canvas{
  width:150px;
  height:150px;
}

/* PRINT */
@page{size:6in 4in;margin:0}

@media print{
  body{background:#fff}
  .no-print{display:none!important}
  .container{padding:0;margin:0}
  .label{display:block}
}
</style>
</head>

<body>
<div class="container">

  <!-- HEADER -->
  <div id="headerMount" class="no-print"></div>

  <!-- VERSION -->
  <div id="versionBadge" class="version-badge no-print"></div>

  <!-- CONTROLS -->
  <div class="controls no-print">
    <select id="barrelSelect">
      <option>Loading barrels…</option>
    </select>
    <button id="btnGenerate">Generate</button>
    <button id="btnPrint" disabled>Print</button>
    <button id="btnClear">Clear</button>
  </div>

  <!-- LABEL -->
  <div id="label" class="label">

    <div class="lbl-header">
      <div class="lbl-r" id="lblSpiritLetter">R</div>
      <div class="lbl-header-text">
        <div class="lbl-title">797 Distillery LLC</div>
        <div>425 E Pleasant Ave</div>
        <div>Covington, Tennessee 38019</div>
        <div class="lbl-dsp">DSP-TN-21154</div>
      </div>
    </div>

    <div class="lbl-rule"></div>

    <div class="lbl-data">
      <div><span>First Fill Date:</span> <b id="vFillDate"></b></div>
      <div><span>Mash Bill:</span> <b id="vMashBill"></b></div>
      <div><span>Product Name:</span> <b id="vSpiritType"></b></div>
      <div><span>Entry Proof:</span> <b id="vEntryProof"></b></div>
      <div><span>Lot Identification No:</span> <b id="vLotId"></b></div>
      <div><span>RC-G:</span> <b id="vRCG"></b></div>
      <div><span>OPG:</span> <b id="vOPG"></b></div>
      <div><span>Barrel Type:</span> <b id="vBarrelType"></b></div>
    </div>

    <div class="lbl-rule"></div>

    <div class="lbl-crest">
      <img src="websiteLogoGlass.png" class="crest-img" alt="797 Distillery Logo">
    </div>

    <div class="lbl-rule"></div>

    <div class="lbl-barrel">
      Barrel # <span id="vBarrelNo"></span>
    </div>

    <div class="lbl-rule"></div>

    <div class="lbl-qr">
      <div id="qrcode"></div>
    </div>

  </div>
</div>

<script>
const APP_VERSION = "Print Label v1.8.5";
const BARREL_STORAGE_CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vSNyLVIgK_UeIZdZQJaGF3IgiqZ68aCG0tydTzszngpgYhu4-HlLXNHotuGPJOA63CKSs-RkZgGtRpt/pub?output=csv";

/* DOM refs */
const versionBadge = document.getElementById("versionBadge");
const headerMount = document.getElementById("headerMount");
const barrelSelect = document.getElementById("barrelSelect");
const label = document.getElementById("label");
const qrcode = document.getElementById("qrcode");
const btnPrint = document.getElementById("btnPrint");

versionBadge.textContent = APP_VERSION + " • " + new Date().toLocaleTimeString();

/* Header */
async function loadHeader(){
  const r = await fetch("header.html", { cache:"no-store" });
  headerMount.innerHTML = await r.text();
}

/* CSV */
function parseCSV(t){
  const [h,...l]=t.split(/\r?\n/).filter(Boolean);
  const headers=h.split(",");
  return l.map(row=>{
    const o={};
    row.split(",").forEach((v,i)=>o[headers[i]]=v.trim());
    return o;
  });
}

let barrels=new Map();

async function loadBarrels(){
  const r=await fetch(BARREL_STORAGE_CSV_URL,{cache:"no-store"});
  const rows=parseCSV(await r.text());
  rows.forEach(o=>barrels.set(o["Barrel No."],o));
  barrelSelect.innerHTML=`<option value="">Select barrel…</option>`+
    [...barrels.keys()].sort().map(b=>`<option>${b}</option>`).join("");
}

function makeQR(url){
  qrcode.innerHTML="";
  if(url)new QRCode("qrcode",{text:url,width:150,height:150});
}

/* Spirit letter */
function setSpiritLetter(spiritType){
  const el=document.getElementById("lblSpiritLetter");
  if(!el)return;

  const s=(spiritType||"").toLowerCase();
  let letter="R";

  if(s.includes("whiskey")) letter="W";
  else if(s.includes("vodka")) letter="V";
  else if(s.includes("moonshine")) letter="M";
  else if(s.includes("rum")) letter="R";

  el.textContent=letter;
}

function fillLabel(o){
  vBarrelNo.textContent=o["Barrel No."];
  vFillDate.textContent=o["Fill Date"];
  vMashBill.textContent=o["Mash Bill"];
  vSpiritType.textContent=o["Spirit Type"];
  vEntryProof.textContent=o["Entry Proof"];
  vLotId.textContent=o["Lot ID"];
  vRCG.textContent=o["RC-G"];
  vOPG.textContent=o["OPG"];
  vBarrelType.textContent=o["Barrel Type"];
  setSpiritLetter(o["Spirit Type"]);
  makeQR(o["Barrel Doc Link"]);
  label.style.display="block";
  btnPrint.disabled=false;
}

btnGenerate.onclick=()=>{
  const o=barrels.get(barrelSelect.value);
  if(o)fillLabel(o);
};

btnClear.onclick=()=>{
  label.style.display="none";
  qrcode.innerHTML="";
  btnPrint.disabled=true;
};

btnPrint.onclick=()=>window.print();

(async()=>{
  await loadHeader();
  await loadBarrels();
})();
</script>
</body>
</html>
