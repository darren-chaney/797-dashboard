<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>797 Distillery – Print Barrel Label</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- VERSION STAMP -->
<!-- 797 BARREL LABEL :: v1.7.0 :: 2025-12-13 -->

<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

<style>
/* ===============================
   SCREEN UI (DASHBOARD)
   =============================== */
body{
  margin:0;
  background:#0f172a;
  color:#e5e7eb;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
}
.container{
  max-width:1100px;
  margin:0 auto;
  padding:16px;
}
.controls{
  background:#111c33;
  border:1px solid #334155;
  border-radius:12px;
  padding:14px;
  display:flex;
  gap:10px;
}
select,button{
  padding:10px 14px;
  border-radius:10px;
  border:1px solid #334155;
  background:#0b1222;
  color:#e5e7eb;
  font-weight:700;
}
button{cursor:pointer}
button:disabled{opacity:.5}

/* ===============================
   LABEL (EXACT 4x6)
   =============================== */
.label{
  width:6in;
  height:4in;
  background:#fff;
  color:#000;
  box-sizing:border-box;
  padding:16px 18px;
  font-family:Arial,Helvetica,sans-serif;
  display:none;
}

/* ===== TOP HEADER ===== */
.lbl-top{
  display:grid;
  grid-template-columns:90px 1fr;
  gap:12px;
  align-items:center;
}
.lbl-big-letter{
  font-size:120px;
  font-weight:900;
  line-height:1;
}
.lbl-company{
  font-size:16px;
  font-weight:900;
}
.lbl-address{
  font-size:14px;
  font-weight:700;
}
.lbl-dsp{
  font-size:14px;
  font-weight:900;
}

/* ===== RULE ===== */
.rule{
  border-top:3px solid #000;
  margin:8px 0;
}

/* ===== DATA GRID ===== */
.data{
  display:grid;
  grid-template-columns:230px 1fr;
  row-gap:6px;
  font-size:15px;
}
.data .k{
  text-align:right;
  font-weight:900;
  padding-right:10px;
}
.data .v{
  text-align:left;
  font-weight:700;
}

/* ===== LOGO ===== */
.crest{
  text-align:center;
  margin:8px 0;
}
.crest img{
  height:190px;
  width:auto;
  object-fit:contain;
}

/* ===== BARREL ===== */
.barrel{
  text-align:center;
  font-size:30px;
  font-weight:900;
  margin:6px 0;
}

/* ===== QR ===== */
.qr{
  display:flex;
  justify-content:center;
}
.qr img,.qr canvas{
  width:150px;
  height:150px;
}

/* ===== VERSION (BOTTOM RIGHT) ===== */
.version{
  position:absolute;
  bottom:6px;
  right:10px;
  font-size:10px;
  font-weight:700;
  color:#444;
}

/* ===============================
   PRINT
   =============================== */
@page{
  size:6in 4in;
  margin:0;
}
@media print{
  body{background:#fff}
  .no-print{display:none!important}
  .container{padding:0;margin:0}
  .label{display:block}
}
</style>
</head>

<body>
<div class="container">

<!-- CONTROLS -->
<div class="controls no-print">
  <select id="barrelSelect">
    <option>Loading barrels…</option>
  </select>
  <button id="btnGenerate">Generate</button>
  <button id="btnPrint" disabled>Print</button>
  <button id="btnClear">Clear</button>
</div>

<!-- LABEL -->
<div id="label" class="label">

  <!-- HEADER -->
  <div class="lbl-top">
    <div id="bigLetter" class="lbl-big-letter">R</div>
    <div>
      <div class="lbl-company">797 Distillery LLC</div>
      <div class="lbl-address">425 E Pleasant Ave</div>
      <div class="lbl-address">Covington, Tennessee 38019</div>
      <div class="lbl-dsp">DSP-TN-21154</div>
    </div>
  </div>

  <div class="rule"></div>

  <!-- DATA -->
  <div class="data">
    <div class="k">First Fill Date:</div><div class="v" id="vFillDate"></div>
    <div class="k">Mash Bill:</div><div class="v" id="vMashBill"></div>
    <div class="k">Product Name:</div><div class="v" id="vSpiritType"></div>
    <div class="k">Entry Proof:</div><div class="v" id="vEntryProof"></div>
    <div class="k">Lot Identification No:</div><div class="v" id="vLotId"></div>
    <div class="k">RC-G:</div><div class="v" id="vRCG"></div>
    <div class="k">OPG:</div><div class="v" id="vOPG"></div>
    <div class="k">Barrel Type:</div><div class="v" id="vBarrelType"></div>
  </div>

  <div class="rule"></div>

  <!-- LOGO -->
  <div class="crest">
    <img src="websiteLogoGlass.png" alt="797 Distillery Logo">
  </div>

  <div class="rule"></div>

  <!-- BARREL -->
  <div class="barrel">
    Barrel # <span id="vBarrelNo"></span>
  </div>

  <div class="rule"></div>

  <!-- QR -->
  <div class="qr">
    <div id="qrcode"></div>
  </div>

  <div class="version">v1.7.0</div>
</div>
</div>

<script>
const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vSNyLVIgK_UeIZdZQJaGF3IgiqZ68aCG0tydTzszngpgYhu4-HlLXNHotuGPJOA63CKSs-RkZgGtRpt/pub?output=csv";

const barrels = new Map();

function parseCSV(t){
  const lines=t.split(/\r?\n/);
  const h=lines.shift().split(",");
  lines.forEach(l=>{
    if(!l.trim())return;
    const o={},c=l.split(",");
    h.forEach((k,i)=>o[k.trim()]=c[i]?.trim()||"");
    barrels.set(o["Barrel No."],o);
  });
}

function makeQR(url){
  qrcode.innerHTML="";
  if(url) new QRCode(qrcode,{text:url,width:150,height:150});
}

function fill(o){
  vBarrelNo.textContent=o["Barrel No."];
  vFillDate.textContent=o["Fill Date"];
  vMashBill.textContent=o["Mash Bill"];
  vSpiritType.textContent=o["Spirit Type"];
  vEntryProof.textContent=o["Entry Proof"];
  vLotId.textContent=o["Lot ID"];
  vRCG.textContent=o["RC-G"];
  vOPG.textContent=o["OPG"];
  vBarrelType.textContent=o["Barrel Type"];
  makeQR(o["Barrel Doc Link"]);

  // BIG LETTER LOGIC
  const s=o["Spirit Type"].toLowerCase();
  bigLetter.textContent = s.includes("rum") ? "R" :
                          s.includes("whiskey") ? "W" :
                          s.includes("vodka") ? "V" : "S";

  label.style.display="block";
  btnPrint.disabled=false;
}

btnGenerate.onclick=()=>{
  const o=barrels.get(barrelSelect.value);
  if(o) fill(o);
};
btnClear.onclick=()=>{
  label.style.display="none";
  btnPrint.disabled=true;
  qrcode.innerHTML="";
};
btnPrint.onclick=()=>window.print();

(async()=>{
  const r=await fetch(CSV_URL);
  parseCSV(await r.text());
  barrelSelect.innerHTML=`<option value="">Select barrel…</option>`+
    [...barrels.keys()].sort().map(b=>`<option>${b}</option>`).join("");
})();
</script>
</body>
</html>
