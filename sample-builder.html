<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sample Builder (R&D)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- GLOBAL HEADER CSS -->
  <link rel="stylesheet" href="header.css?v=1.0.0">

  <style>
    :root{
      --bg:#0f172a;
      --panel:#111c33;
      --panel2:#0f1a31;
      --border:#334155;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --good:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --btn:#111c33;
      --btn2:#0b1223;
      --chip:#0b1223;
      --shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }
    main{
      max-width:1000px;
      margin:0 auto;
      padding:28px 18px 40px;
    }
    .subtitle{color:var(--muted); margin:6px 0 20px}
    .row{display:flex; gap:14px; flex-wrap:wrap;}
    .panel{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:14px;
      padding:18px;
      box-shadow: var(--shadow);
    }
    .panel h2{margin:0 0 12px; font-size:1.05rem;}
    .panel .hint{color:var(--muted); font-size:.92rem; margin-top:6px}
    .grow{flex:1 1 520px;}
    .side{flex:1 1 320px; min-width:280px;}

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border:1px solid var(--border);
      border-radius:999px;
      background:var(--chip);
      color:var(--text);
      font-size:.85rem;
      white-space:nowrap;
    }
    .badge b{font-weight:700}
    .badge.warn{border-color: rgba(245,158,11,.55); color:#fcd34d;}
    .badge.good{border-color: rgba(34,197,94,.55); color:#86efac;}
    .badge.muted{color:var(--muted);}

    label{display:block; font-size:.92rem; color:var(--muted); margin:10px 0 6px;}
    input[type="text"], textarea, select{
      width:100%;
      box-sizing:border-box;
      background:var(--btn2);
      color:var(--text);
      border:1px solid var(--border);
      border-radius:10px;
      padding:10px 12px;
      outline:none;
      font-size:1rem;
    }
    textarea{min-height:84px; resize:vertical;}

    .radioRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .pill{
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border:1px solid var(--border);
      border-radius:12px;
      background:var(--btn2);
      user-select:none;
    }
    .pill input{accent-color:#e5e7eb;}
    .pill .mini{color:var(--muted); font-size:.84rem;}

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:14px;
    }
    button{
      appearance:none;
      border:1px solid var(--border);
      background:var(--btn2);
      color:var(--text);
      border-radius:12px;
      padding:10px 12px;
      font-size:1rem;
      cursor:pointer;
    }
    button.primary{
      background:var(--btn);
      border-color:#486081;
    }
    button:disabled{
      opacity:.55;
      cursor:not-allowed;
    }

    .divider{height:1px; background:var(--border); margin:14px 0;}

    table{
      width:100%;
      border-collapse:collapse;
      overflow:hidden;
      border-radius:12px;
      border:1px solid var(--border);
    }
    th, td{
      padding:10px 10px;
      border-bottom:1px solid rgba(51,65,85,.7);
      vertical-align:top;
      font-size:.95rem;
    }
    th{
      background:#0b1223;
      color:#cbd5e1;
      text-align:left;
      font-weight:650;
    }
    tr:last-child td{border-bottom:none;}
    .muted{color:var(--muted)}
    .warnLine{color:#fcd34d;}
    .small{font-size:.9rem;}

    details{
      background:var(--panel2);
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px 12px;
    }
    details summary{
      cursor:pointer;
      color:#cbd5e1;
      font-weight:650;
      list-style:none;
    }
    details summary::-webkit-details-marker{display:none;}
    .explainList{margin:10px 0 0; padding-left:16px; color:var(--muted);}
    .explainList li{margin:6px 0;}

    /* Modal */
    .modalBackdrop{
      position:fixed; inset:0;
      background:rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:9999;
    }
    .modal{
      width:min(720px, 100%);
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow: var(--shadow);
      padding:18px;
    }
    .modal h3{margin:0 0 12px;}
    .modal .modalActions{display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap; margin-top:14px;}
    .checkRow{display:flex; gap:10px; align-items:flex-start; margin-top:10px; color:#cbd5e1;}
    .checkRow input{margin-top:3px; accent-color:#e5e7eb;}
    .twoCol{display:grid; grid-template-columns:1fr 1fr; gap:12px;}
    @media (max-width: 780px){
      .twoCol{grid-template-columns:1fr;}
    }
  </style>
</head>

<body>
  <!-- GLOBAL HEADER -->
  <div id="global-header"></div>

  <main>
    <div class="row" style="align-items:flex-start; justify-content:space-between;">
      <div>
        <h1 style="margin:0 0 6px;">Sample Builder (R&D)</h1>
        <div class="subtitle">Create small-batch tasting samples (max 375 mL). Drafts only â€” promote after tasting.</div>
      </div>
      <div class="badge warn" title="R&D tool only â€” not production">
        ðŸ§ª <b>R&D ONLY</b> <span class="muted">â€¢ Max 375 mL</span>
      </div>
    </div>

    <div class="row">
      <!-- INPUT -->
      <section class="panel grow">
        <h2>Sample Inputs</h2>

        <label>Sample Size</label>
        <div class="radioRow" id="sampleSizeRow">
          <label class="pill"><input type="radio" name="sampleSize" value="100"> 100 mL <span class="mini">(micro)</span></label>
          <label class="pill"><input type="radio" name="sampleSize" value="250" checked> 250 mL <span class="mini">(standard)</span></label>
          <label class="pill"><input type="radio" name="sampleSize" value="375"> 375 mL <span class="mini">(MAX)</span></label>
        </div>

        <div class="twoCol">
  <div>
    <label>Base Spirit Type</label>
    <select id="baseSpiritType">
      <option value="Moonshine">Moonshine</option>
      <option value="Vodka">Vodka</option>
      <option value="Rum">Rum</option>
    </select>
    <div class="hint">
      Used only for conservative bias rules (not production logic).
    </div>
  </div>

  <div>
    <label>Sweetness (HFCS-42)</label>
    <div class="radioRow" id="sweetnessRow">
      <label class="pill">
        <input type="radio" name="sweetness" value="none"> None
      </label>
      <label class="pill">
        <input type="radio" name="sweetness" value="10"> 10%
      </label>
      <label class="pill">
        <input type="radio" name="sweetness" value="12" checked> 12%
      </label>
      <label class="pill">
        <input type="radio" name="sweetness" value="14"> 14%
      </label>
    </div>
    <div class="hint">
      HFCS mL is computed as % of finished sample volume.
    </div>
  </div>
</div>

<div class="twoCol">
  <div>
    <label>Base Spirit Proof</label>
    <input
      id="baseProof"
      type="number"
      value="155"
      min="80"
      max="200"
    />
    <div class="hint">
      Proof of the spirit before dilution (example: 155).
    </div>
  </div>

  <div>
    <label>Target Sample Proof</label>
    <input
      id="targetProof"
      type="number"
      value="60"
      min="40"
      max="100"
    />
    <div class="hint">
      Proof you want to taste (example: 60).
    </div>
  </div>
</div>


        <label>Flavor Concept</label>
        <input id="flavorConcept" type="text" placeholder='Example: "Strawberry Cream"' />

        <label>Flavor Strength</label>
        <div class="radioRow" id="strengthRow">
          <label class="pill"><input type="radio" name="strength" value="Mild"> Mild</label>
          <label class="pill"><input type="radio" name="strength" value="Strong" checked> Strong</label>
          <label class="pill"><input type="radio" name="strength" value="Extreme"> Extreme <span class="mini">(warn)</span></label>
        </div>

        <div class="actions">
          <button class="primary" id="btnGenerate">Generate Starting Sample</button>
          <button id="btnClear">Clear</button>
          <span id="inputWarning" class="badge muted" style="display:none;"></span>
        </div>

        <div class="divider"></div>
        <div class="badge muted small">Locked Flavor Ranges: <b>v1.0</b> â€¢ Output is <b>R&D tasting only</b></div>
      </section>

      <!-- SIDE: DRAFTS -->
      <aside class="panel side">
        <h2>Drafts & Recipes</h2>
        <div class="hint">Saved locally in this browser (localStorage).</div>

        <div class="actions" style="margin-top:10px;">
          <button id="btnSaveDraft" disabled>Save Draft</button>
          <button id="btnLoadLast">Load Last</button>
        </div>

        <div class="divider"></div>

        <div class="actions">
          <button id="btnExportDraft" disabled>Export Draft JSON</button>
          <button id="btnExportRecipes">Export Base Recipes JSON</button>
        </div>

        <div class="divider"></div>
        <div id="draftList" class="small muted">No drafts yet.</div>
      </aside>
    </div>

    <!-- OUTPUT -->
    <section class="panel" id="outputPanel" style="margin-top:14px; display:none;">
      <div class="row" style="align-items:center; justify-content:space-between;">
        <div>
          <h2 style="margin:0;">Generated Sample</h2>
          <div class="muted small" id="sampleMeta"></div>
        </div>
        <div id="statusChip" class="badge warn">ðŸ§ª R&D Sample â€” Not Production Ready</div>
      </div>

      <div class="divider"></div>

      <div id="warningBlock" style="display:none;" class="small warnLine"></div>

      <table id="ingredientTable" aria-label="Ingredient table">
        <thead>
          <tr>
            <th style="width:32%;">Component</th>
            <th style="width:18%;">mL</th>
            <th style="width:18%;">L</th>
            <th style="width:18%;">g / kg</th>
            <th style="width:14%;">Notes</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="divider"></div>

      <div class="panel" style="background:var(--panel2); margin:0;">
        <h2 style="margin:0 0 10px; font-size:1rem;">Adjustment Guidance</h2>
        <ul id="adjustmentList" class="small" style="margin:0; padding-left:18px;"></ul>
      </div>

      <div class="divider"></div>

      <details>
        <summary>Why these amounts?</summary>
        <ul id="explainList" class="explainList"></ul>
      </details>

      <div class="divider"></div>

      <div class="row" style="justify-content:space-between; align-items:center;">
        <div class="muted small">
          This sample is for R&D tasting only. Promote only after successful evaluation.
        </div>
        <div class="actions" style="margin:0;">
          <button id="btnDuplicate" disabled>Duplicate & Adjust</button>
          <button id="btnPromote" disabled class="primary">Promote to Base Recipe</button>
        </div>
      </div>
    </section>
  </main>

  <!-- PROMOTION MODAL -->
  <div class="modalBackdrop" id="promoBackdrop" role="dialog" aria-modal="true" aria-label="Promote to Base Recipe">
    <div class="modal">
      <h3>Promote to Base Recipe</h3>
      <div class="muted small" id="promoHint"></div>

      <div class="divider"></div>

      <label>Base Recipe Name (required)</label>
      <input id="promoRecipeName" type="text" placeholder='Example: "Strawberry Cream Moonshine"' />

      <label>Internal Notes (required)</label>
      <textarea id="promoNotes" placeholder="Tasting notes, why it works, any do-not-exceed notes..."></textarea>

      <div class="checkRow">
        <input type="checkbox" id="chkTasted">
        <label for="chkTasted">I tasted this sample at 375 mL.</label>
      </div>
      <div class="checkRow">
        <input type="checkbox" id="chkBalanced">
        <label for="chkBalanced">Flavor balance is acceptable.</label>
      </div>
      <div class="checkRow">
        <input type="checkbox" id="chkUnderstood">
        <label for="chkUnderstood">This will become a scalable base recipe (authority input for the Scaler).</label>
      </div>

      <div class="modalActions">
        <button id="btnCancelPromo">Cancel</button>
        <button id="btnConfirmPromo" class="primary">Confirm Promotion</button>
      </div>
      <div id="promoError" class="small" style="margin-top:10px; color:#fca5a5; display:none;"></div>
    </div>
  </div>

  <!-- HEADER LOADER -->
  <script>
    fetch("header.html")
      .then(res => res.text())
      .then(html => { document.getElementById("global-header").innerHTML = html; })
      .catch(() => {});
  </script>

  <script src="logic.js?v=1.0.0"></script>
  <script src="ui.js?v=1.0.0"></script>
</body>
</html>
